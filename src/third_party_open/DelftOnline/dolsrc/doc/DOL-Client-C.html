<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <meta content="text/html; charset=ISO-8859-1"
 http-equiv="content-type">
  <title>DOL-Client</title>
  <style>
H1 { font-family: Helvetica,Arial; color: #048; }
H2 { color: #048; font-family: Helvetica, Arial; margin-top: 25px }
H3 { font-family: Helvetica,Arial; }
H4 { }
  </style>
</head>
<body>
<h1>DelftOnline (DOL) Client C++ API</h1>
<br style="font-weight: bold;">
<span style="color: rgb(255, 0, 0); font-weight: bold;">DRAFT</span><br>
<br>
<a href="mailto:Irv.Elshoff@wldelft.nl">Irv.Elshoff@wldelft.nl</a><br>
27 apr 06<br>
<br>
This document describes the C++ interface between a DelftOnline client
and
a DOL-enabled simulation.<br>
<br>
In general, if an error occurs during the execution of a function it
will return a special error code<br>
<br>
<hr style="width: 100%; height: 2px;">
<h3>Constructor</h3>
<div style="margin-left: 40px;"><span style="font-family: monospace;">DOL_Session
* dol = new DOL_Session (char * url);</span><br>
</div>
<br>
Create a connection to an online data server at the specified URL,
which is a string of the form <span style="font-family: monospace;">dol://<span
 style="font-style: italic;">hostname</span>:<span
 style="font-style: italic;">tcpport</span>/<span
 style="font-style: italic;">authenticator</span></span><span
 style="font-style: italic;">.</span><br>
<br>
A client can connect to
more than one server, and servers are able to service more than one
client.<br>
<br>
<br>
<hr style="width: 100%; height: 2px;">
<h3>Getting Information About the Simulator</h3>
<br>
<div style="margin-left: 40px;"><span style="font-family: monospace;">char
* description = dol-&gt;<span style="font-weight: bold;">GetDescription</span>
();</span><br>
</div>
<br>
Return a textual description of the online server for display
purposes.&nbsp; Typically contains the type and version of the
simulator (e.g., "Delft3D-FLOW 3.73.00.00"), but may also contain
run-specific information.&nbsp; The format of the returned data is not
specified, and may be subject ot change at any time.<br>
<span style="font-family: monospace;"></span><br>
<br style="font-family: monospace;">
<div style="margin-left: 40px;"><span style="font-family: monospace;">int
numdomains = dol<span style="font-family: mon;"><span
 style="font-weight: bold;">-&gt;</span></span><span
 style="font-weight: bold;">GetDomainCount</span>
();</span><br style="font-family: monospace;">
<br style="font-family: monospace;">
<span style="font-family: monospace;">char * domainname = dol<span
 style="font-family: mon;"><span style="font-weight: bold;">-&gt;</span></span><span
 style="font-weight: bold;">GetDomain<span
 style="font-family: monospace;">Name</span></span> (int dom);</span><span
 style="font-family: monospace;"></span>
</div>
<br>
The count function returns the number of the subdomains for simulators
that use domain
decomposition, or zero otherwise.&nbsp; The name function returns the
character string name of the <span style="font-family: monospace;">dom-</span>th
subdomain (for Delft3D-Flow this is the "runid"), where <span
 style="font-family: monospace;">dom</span> is an integer between one
and <span style="font-family: monospace;">numdomains</span>.&nbsp; The
count function must be called at least once before the first call to
the name function.&nbsp; Each time the count function is called, the
numbering of the domains may change.<br>
<br>
[ <span style="font-style: italic;">Note: The following set of
functions is not yet implemented, and the API may change before they
are implemented</span>. ]<br>
<br>
<div style="margin-left: 40px;"><span style="font-family: monospace;">int
numvariables = dol-&gt;<span style="font-weight: bold;">GetVariableCount</span>
(</span><span style="font-family: monospace;">int dom</span><span
 style="font-family: monospace;">);<br style="font-family: monospace;">
</span><br style="font-family: monospace;">
<span style="font-family: monospace;">String domainname = dol</span><span
 style="font-family: monospace;">-&gt;</span><span
 style="font-family: monospace;"><span style="font-weight: bold;">Get<span
 style="font-family: monospace;">VariableName</span></span>
(int dom, int var);<br>
</span><br style="font-family: monospace;">
<span style="font-family: monospace;">String domainname = dol</span><span
 style="font-family: monospace;">-&gt;</span><span
 style="font-family: monospace;"><span style="font-weight: bold;">Get<span
 style="font-family: monospace;">VariableDescription</span></span>
(int dom, int var);<br>
</span><br style="font-family: monospace;">
<span style="font-family: monospace;">int basetype = dol</span><span
 style="font-family: monospace;">-&gt;</span><span
 style="font-family: monospace;"><span style="font-weight: bold;">Get<span
 style="font-family: monospace;">VariableBaseType</span></span>
(int dom, int var);<br>
</span><br style="font-family: monospace;">
<span style="font-family: monospace;">int numdims = dol</span><span
 style="font-family: monospace;">-&gt;</span><span
 style="font-family: monospace;"><span style="font-weight: bold;">Get<span
 style="font-family: monospace;">VariableDimensionCount</span></span>
(int dom, int var);<br>
</span><br style="font-family: monospace;">
<span style="font-family: monospace;">int dimension = dol</span><span
 style="font-family: monospace;">-&gt;</span><span
 style="font-family: monospace;"><span style="font-weight: bold;">Get<span
 style="font-family: monospace;">VariableDimension</span></span>
(int dom, int var, int dim);</span><span style="font-family: monospace;"><br
 style="font-family: monospace;">
</span><span style="font-family: monospace;"></span><br
 style="font-family: monospace;">
&nbsp;<span style="font-family: monospace;">public static
final int<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
INTEGER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = 1,</span><br
 style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
REAL&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; =
2,</span><br style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
DOUBLE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = 3,</span><br
 style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
CHARACTER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = 4,</span><br
 style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
LOGICAL&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = 5,</span><br
 style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
COMPLEX&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = 6,</span><span
 style="font-family: monospace;"></span><br
 style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; DOUBLE_COMPLEX = 7;</span><span
 style="font-family: monospace;"><br>
</span></div>
<span style="font-family: monospace;"><span
 style="font-family: monospace;"><br>
</span></span>This group of functions provides information about the
variables in the simulator.&nbsp; Each subdomain has it's own set of
variables, so the subdomain number is an argument to all calls. If the
simulator uses only a single domain, zero should be passed.<br>
<br>
Variables are generally N-dimensional arrays of a Fortran base type.<br>
<br>
The variable count function returns the number of variables (a
non-negative integer) published by the specified subdomain.&nbsp; The
variables are numbered from one to <span
 style="font-family: monospace;">numvariables</span> in the subsequent
functions.&nbsp; The count function must be called at least once before
any of the other function may be called.<br>
<br>
The name and description functions return the short (simulator) and
long (human) names for the specified variable, respectively.<br>
<br>
Variables are N-dimensional arrays of a Fortran base type. The base
type is encoded as an integer and return by <span
 style="font-family: monospace;">Get<span
 style="font-family: monospace;">VariableBaseType</span></span>. To
make the client program more readable, symbolic names are given to the
seven base types in the DOL_Session class.&nbsp; It is recommended that
these names are redefined in the client Fortran and or C++ code (or
even better, accessed through JNI).<br>
<br>
The dimension count function returns the number of dimensions of the
variable.&nbsp; Scalars have dimensionality zero.&nbsp; The dimension
function returns the number of elements in the <span
 style="font-family: monospace;">dim</span>-th dimension, or zero if <span
 style="font-family: monospace;">dim</span> is greater than the number
of dimensions, or the variable is a scalar.<br>
<br>
[ <span style="font-style: italic;">End of not-yet-implemented set of
functions.</span> ]<br>
<br>
<br>
<hr style="width: 100%; height: 2px;">
<h3>Data Access</h3>
<br>
<span style="font-style: italic;">To be determined.</span><br>
<br>
<br>
<hr style="width: 100%; height: 2px;">
<h3>Time Step Control<br>
</h3>
<br>
<span style="font-family: monospace;"><span
 style="font-family: monospace;"></span>&nbsp;&nbsp;&nbsp; </span><span
 style="font-family: monospace;">int timestep =
</span><span style="font-family: monospace;">dol<span
 style="font-family: mon;"><span style="font-weight: bold;">-&gt;</span></span><span
 style="font-weight: bold;">StopSimulation</span> ();</span><br>
<br>
Stop the simulation at the next time step if it is running.&nbsp;&nbsp;
The call blocks until simulation has stopped, then returns the current
time
step.&nbsp; If the simualtion was already stopped the call just returns
zero.<br>
<br>
<br>
<span style="font-family: monospace;">&nbsp;&nbsp;&nbsp; bool
nowrunning = dol<span style="font-family: mon;"><span
 style="font-weight: bold;">-&gt;</span></span><span
 style="font-weight: bold;">ResumeSimulation</span> ();</span><br>
<br>
Start the simulation (again) if it is stopped.&nbsp; Has no effect if
the simulation is already running.&nbsp; The simulation will continue
to run until the end, or some client stops it.<br>
<br>
<br>
<span style="font-family: monospace;">&nbsp;&nbsp;&nbsp; int timestep =
dol.<span style="font-weight: bold;">StepSimulation</span> (int steps);</span><br>
<br>
Allow the simulation to continue for the specified number of full time
steps.&nbsp; Blocks until the desired number of time steps have been
simulated, or another client stops the simulation.&nbsp; If two or more
clients are controlling a simulation, we assume they are acting in
concert.&nbsp; Returns the most recently completed time step.&nbsp; The
first time step is numbered 1.<br>
<br>
<br>
<div style="margin-left: 40px;"><span style="font-family: monospace;">class
DOL_State {</span><br style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp;&nbsp; public boolean
running;</span><br style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp;&nbsp; public int
timestep;</span><br style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp;&nbsp; };</span><br
 style="font-family: monospace;">
<br style="font-family: monospace;">
<span style="font-family: monospace;">DOL_State state = dol.<span
 style="font-weight: bold;">GetState</span> ();</span><br
 style="font-family: monospace;">
<br style="font-family: monospace;">
</div>
Returns the current state of the simulation, including whether it is
running or stopped and the most recently completed whole time
step.&nbsp; The first time step is numbered 1.&nbsp; A time step value
of zero means the server application is stopped at the beginning of the
simulation.<br>
<br>
<div style="margin-left: 40px;"><span style="font-family: monospace;">dol.<span
 style="font-weight: bold;">TerminateSimulation</span> ();</span><br>
</div>
<br>
Cause the server application to terminate immediately, regardless of
its state or the presence of other clients.&nbsp; After this call
returns, no methods of the DOL object may be invoked.<br>
<br>
<br>
<hr style="width: 100%; height: 2px;">
<h3>Exceptions</h3>
<br>
The DOL Client interface can throw the following exceptions:<br>
<br>
<div style="margin-left: 40px;"><span
 style="font-family: monospace; font-weight: bold;">DOL_ServerDead</span><br>
</div>
<br>
Occurs when the server is no longer alive, for example because it
spontaneously abortted, or was told to terminate by a client.<br>
<br>
<div style="margin-left: 40px;"><span
 style="font-family: monospace; font-weight: bold;">DOL_Invalid</span><br>
</div>
<br>
A general exception for invalid arguments (e.g., a negative number of
time steps in <span style="font-family: monospace;">StepSimulation</span>)
or method invocations (e.g., calling <span
 style="font-family: monospace;">GetIntegerValue</span> for a
floating point variable).<br>
<br>
<br>
<br>
</body>
</html>
